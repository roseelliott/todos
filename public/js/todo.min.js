function loaded(){pullDownEl=document.getElementById("pullDown"),pullDownOffset=pullDownEl.offsetHeight,myScroll=new iScroll("wrapper",{useTransition:!0,topOffset:pullDownOffset,onRefresh:function(){pullDownEl.className.match("loading")&&(pullDownEl.className="",pullDownEl.querySelector(".pullDownLabel").innerHTML="Pull down to refresh...")},onBeforeScrollStart:function(e){var t=e.explicitOriginalTarget?e.explicitOriginalTarget.nodeName.toLowerCase():e.target?e.target.nodeName.toLowerCase():"";t!="select"&&t!="option"&&t!="input"&&t!="textarea"&&e.preventDefault()},onScrollMove:function(){this.y>5&&!pullDownEl.className.match("flip")?(pullDownEl.className="flip",pullDownEl.querySelector(".pullDownLabel").innerHTML="Release to refresh...",this.minScrollY=0):this.y<5&&pullDownEl.className.match("flip")&&(pullDownEl.className="",pullDownEl.querySelector(".pullDownLabel").innerHTML="Pull down to refresh...",this.minScrollY=-pullDownOffset)},onScrollEnd:function(){pullDownEl.className.match("flip")&&(pullDownEl.className="loading",pullDownEl.querySelector(".pullDownLabel").innerHTML="Loading...",setTimeout(function(){App.refresh(function(){myScroll.refresh()})},10))}}),setTimeout(function(){document.getElementById("wrapper").style.left="0"},800)}var myScroll,pullDownEl,pullDownOffset,generatedCount=0;document.addEventListener("touchmove",function(e){e.preventDefault()},!1),document.addEventListener("DOMContentLoaded",function(){setTimeout(loaded,200)},!1),function(){function e(e,t){return e.write('<input type="text" value="').reference(t.get("title"),t,"h").write('" /><a class="save">Save</a>')}return dust.register("item-edit.dust",e),e}(),function(){function e(e,r){return e.write('<div class="view"><input id="c_').reference(r.get("id"),r,"h").write('" class="toggle" type="checkbox" ').section(r.get("done"),r,{"else":t,block:n},null).write(' /><label for="c_').reference(r.get("id"),r,"h").write('">').reference(r.get("title"),r,"h").write('</label><a class="destroy"></a><a class="edit" data-position-to="window"></a></div>')}function t(e,t){return e.write(' "" ')}function n(e,t){return e.write(' checked="checked" ')}return dust.register("item.dust",e),e}(),function(){function e(e,n){return e.helper("if",n,{block:t},{cond:s}).write('<div id="todo-count"><span>').reference(n.get("remaining"),n,"h").write(" ").helper("if",n,{"else":o,block:u},{cond:a}).write(" left</span></div>")}function t(e,t){return e.write(' <a id="clear-completed">Clear ').reference(t.get("done"),t,"h").write(" completed ").helper("if",t,{"else":n,block:r},{cond:i}).write("</a>")}function n(e,t){return e.write(" items")}function r(e,t){return e.write(" item ")}function i(e,t){return e.reference(t.get("done"),t,"h").write(" == 1")}function s(e,t){return e.reference(t.get("done"),t,"h").write(" > 0")}function o(e,t){return e.write(" item")}function u(e,t){return e.write(" items")}function a(e,t){return e.reference(t.get("remaining"),t,"h").write(" > 1")}return dust.register("stats.dust",e),e}();var TodoApp=TodoApp||{};(function(){TodoApp.Models=function(){function e(){return((1+Math.random())*65536|0).toString(16).substring(1)}function t(){return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}var n=Backbone.Model.extend({defaults:function(){return{title:"?",order:TodoApp.Todos.nextOrder(),done:!1}},initialize:function(){this.get("id")||this.set({id:t()}),this.get("title")||this.set({title:this.defaults().title})},url:function(){return"/todos/"+this.get("id")},toggle:function(){this.save({done:!this.get("done")})},clear:function(){this.destroy()}}),r=Backbone.Collection.extend({model:n,url:function(){return"/todos"},done:function(){return this.filter(function(e){return e.get("done")})},remaining:function(){return this.without.apply(this,this.done())},nextOrder:function(){return this.length?this.last().get("order")+1:1},comparator:function(e){return e.get("order")}}),i=new r;return{Todo:n,TodoList:r}}(),TodoApp.Todos=function(){return new TodoApp.Models.TodoList}()})();var TodoApp=TodoApp||{};(function(){TodoApp.Views=function(){var e=Backbone.View.extend({el:$("#todoapp"),events:{"keypress #new-todo":"createOnEnter","click #clear-completed":"clearCompleted","change #toggle-all":"toggleAllComplete"},initialize:function(){this.main=this.$("#main"),this.newtodo=this.$("#new-todo"),this.allCheckbox=this.$("#toggle-all")[0],this.todolist=this.$("#todo-list"),this.status=this.$("#status"),TodoApp.Todos.on("add",this.addOne,this),TodoApp.Todos.on("reset",this.addAll,this),TodoApp.Todos.on("all",this.render,this),TodoApp.Todos.fetch()},refresh:function(e){this.todolist.empty(),TodoApp.Todos.fetch({success:function(t,n){e.call()}})},render:function(){var e=TodoApp.Todos.done().length,t=TodoApp.Todos.remaining().length,n=this;dust.render("stats.dust",{done:e,remaining:t},function(e,t){n.main.show(),n.status.show(),n.status.html(t)}),this.allCheckbox.checked=!t},addOne:function(e){var n=new t({model:e});this.$("#todo-list").append(n.render().el)},addAll:function(){TodoApp.Todos.each(this.addOne)},createOnEnter:function(e){if(e.keyCode!=13)return;if(!this.newtodo.val())return;TodoApp.Todos.create({title:this.newtodo.val()}),this.newtodo.val("")},clearCompleted:function(){return _.each(TodoApp.Todos.done(),function(e){e.clear()}),!1},toggleAllComplete:function(){var e=this.allCheckbox.checked;TodoApp.Todos.each(function(t){t.save({done:e})})}}),t=Backbone.View.extend({tagName:"li",events:{"click .toggle":"toggleDone","click a.edit":"edit","click a.destroy":"clear"},initialize:function(){this.model.on("change",this.render,this),this.model.on("destroy",this.remove,this)},render:function(){var e=this;return dust.render("item.dust",this.model.toJSON(),function(t,n){e.$el.html(n),e.$el.toggleClass("done",e.model.get("done"))}),this},toggleDone:function(){this.model.toggle()},edit:function(e){var t=new n({model:this.model});$("#popupEdit").html(t.render().el).popup("open",{corners:!0})},clear:function(){this.model.clear()}}),n=Backbone.View.extend({events:{"click a":"save","keypress input":"updateOnEnter"},initialize:function(){},render:function(){var e=this;return dust.render("item-edit.dust",this.model.toJSON(),function(t,n){e.$el.html(n)}),this},focus:function(){this.$("input[type=text]").focus()},save:function(){this.input=this.$("input[type=text]");var e=this.input.val();e||this.clear(),this.model.save({title:e}),this.close()},updateOnEnter:function(e){e.keyCode==13&&this.save()},close:function(){$("#popupEdit").popup("close")},clear:function(){this.model.clear()}});return{AppView:e,TodoView:t,TodoEditView:n}}(),App=new TodoApp.Views.AppView})();